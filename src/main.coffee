class Game
  constructor: (@canvas) ->
    @context = @canvas.getContext('2d')
    @width   = @canvas.width
    @height  = @canvas.height
    @player = new Player()
    @enemy = new Enemy()
    KeyHandler.listen()

  loadLevel: (map) =>
    @level = new Level(map)
    @level.findIntersection(0, 0, 100, 100)

  render: =>
    @player.update()
    @level.render()
    @player.render()
    @enemy.update()
    @enemy.render()
    requestAnimationFrame(@render, @canvas)


window.game = new Game(document.getElementById('game'))
map = ['x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x', 'x', 'x', 'x', '.', '.', 'x', '.', '.', 'x',
       'x', '.', 'x', 'x', '.', '.', 'x', 'x', '.', '.', '.', 'x', 'x', '.', '.', '.', 'x', '.', '.', 'x',
       'x', '.', 'x', 'x', '.', '.', 'x', 'x', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x', 'x', '.', '.', 'x',
       'x', '.', 'x', 'x', '.', '.', 'x', 'x', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', 'x',
       'x', '.', 'x', 'x', '.', '.', 'x', 'x', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x', 'x', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', 'x', 'x', 'x', '.', '.', 'x', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', 'x', 'x', '.', '.', 'x', 'x', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', 'x', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', 'x', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', 'x', 'x', 'x', 'x', 'x', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', 'x', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', 'x', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x',
       'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x']

game.loadLevel(map)
game.render()
#new Pathfinder(2, 4, 6, 4)